<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DC Comics Bookshelf</title>
  <style>
    /* Base page styling */
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      padding: 40px 30px;
      margin: 0;
      color: #333;
      min-height: 100vh;
    }

    h1 {
      font-size: 2.5rem;
      font-weight: 700;
      text-align: center;
      margin-bottom: 40px;
      color: #1a1a1a;
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    /* Apple Books-style bookshelf layout */
    .bookshelf {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 40px 30px;
      justify-content: center;
      padding: 40px 20px 60px;
      position: relative;
      background: 
        linear-gradient(90deg, transparent 0%, rgba(139, 69, 19, 0.1) 2%, rgba(139, 69, 19, 0.2) 3%, transparent 4%),
        linear-gradient(0deg, #8B4513 0%, #A0522D 20%, #CD853F 100%);
      border-radius: 20px;
      box-shadow: 
        0 10px 30px rgba(0,0,0,0.2),
        inset 0 1px 0 rgba(255,255,255,0.2),
        inset 0 -2px 0 rgba(0,0,0,0.1);
      margin: 20px auto;
      max-width: 1200px;
    }

    .bookshelf::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, 
        transparent 0%, 
        rgba(139, 69, 19, 0.3) 10%, 
        rgba(160, 82, 45, 0.4) 50%, 
        rgba(139, 69, 19, 0.3) 90%, 
        transparent 100%);
      border-radius: 20px 20px 0 0;
    }

    /* Comic Book Card */
    .comic-card {
      width: 180px;
      height: 280px;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 
        0 8px 25px rgba(0,0,0,0.25),
        0 2px 8px rgba(0,0,0,0.15);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      position: relative;
      cursor: pointer;
      transform-origin: bottom center;
    }

    .comic-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, transparent 50%);
      pointer-events: none;
      z-index: 1;
    }

    .comic-card img {
      width: 100%;
      height: 240px;
      object-fit: cover;
      background-color: #f8f9fa;
      display: block;
    }

    .comic-card h3 {
      font-size: 0.85rem;
      font-weight: 600;
      margin: 0;
      padding: 8px 10px;
      text-align: center;
      line-height: 1.2;
      color: #333;
      background: rgba(255,255,255,0.95);
      backdrop-filter: blur(10px);
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Add Book Card */
    .add-book-card {
      width: 180px;
      height: 280px;
      background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
      border: 3px dashed #adb5bd;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 4rem;
      font-weight: 300;
      color: #6c757d;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      position: relative;
      overflow: hidden;
    }

    .add-book-card::before {
      content: 'Add Comic';
      position: absolute;
      bottom: 20px;
      font-size: 0.9rem;
      font-weight: 500;
      opacity: 0.7;
    }

    /* Hover effects */
    .comic-card:hover {
      transform: translateY(-10px) scale(1.05);
      box-shadow: 
        0 15px 40px rgba(0,0,0,0.3),
        0 5px 15px rgba(0,0,0,0.2);
      z-index: 10;
    }

    .add-book-card:hover {
      transform: translateY(-5px) scale(1.02);
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-color: #868e96;
      color: #495057;
    }

    /* Add Book Panel */
    .panel {
      max-width: 700px;
      margin: 30px auto;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 
        0 20px 60px rgba(0, 0, 0, 0.15),
        0 8px 25px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .hidden {
      display: none;
    }

    /* Search Bar + Button */
    .search-bar-container {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
    }

    .search-bar-container input {
      flex: 1;
      padding: 15px 20px;
      border-radius: 12px;
      border: 2px solid #e9ecef;
      font-size: 1.1rem;
      background: rgba(255, 255, 255, 0.8);
      transition: all 0.3s ease;
    }

    .search-bar-container input:focus {
      outline: none;
      border-color: #007aff;
      background: rgba(255, 255, 255, 1);
      box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
    }

    .search-bar-container button {
      padding: 15px 25px;
      border: none;
      background: linear-gradient(135deg, #007aff 0%, #0056cc 100%);
      color: white;
      border-radius: 12px;
      cursor: pointer;
      font-size: 1.1rem;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0, 122, 255, 0.3);
    }

    .search-bar-container button:hover {
      background: linear-gradient(135deg, #0056cc 0%, #004499 100%);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 122, 255, 0.4);
    }

    .search-bar-container button:active {
      transform: translateY(0);
    }

    /* Close button */
    .close-panel {
      position: absolute;
      top: 15px;
      right: 20px;
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #6c757d;
      padding: 5px;
      border-radius: 50%;
      width: 35px;
      height: 35px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .close-panel:hover {
      background: rgba(108, 117, 125, 0.1);
      color: #495057;
    }

    /* Search results */
    #searchResults {
      max-height: 400px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 20px;
    }

    .search-result {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 12px;
      border-radius: 12px;
      background: rgba(248, 249, 250, 0.8);
      cursor: pointer;
      transition: all 0.2s ease;
      border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .search-result:hover {
      background: rgba(233, 236, 239, 0.9);
      transform: translateX(5px);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .search-result img {
      width: 60px;
      height: 90px;
      object-fit: cover;
      border-radius: 6px;
      background-color: #e9ecef;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .search-result-info {
      flex: 1;
    }

    .search-result-title {
      font-size: 1rem;
      font-weight: 600;
      color: #333;
      line-height: 1.4;
      margin-bottom: 4px;
    }

    .search-result-details {
      font-size: 0.85rem;
      color: #666;
      line-height: 1.3;
    }

    /* Show more link */
    .show-more {
      text-align: center;
      font-size: 1rem;
      font-weight: 600;
      color: #007aff;
      cursor: pointer;
      padding: 15px;
      border-radius: 12px;
      transition: all 0.2s ease;
      background: rgba(0, 122, 255, 0.05);
      border: 1px solid rgba(0, 122, 255, 0.1);
    }

    .show-more:hover {
      background: rgba(0, 122, 255, 0.1);
      transform: translateY(-2px);
    }

    /* Loading state */
    .search-loading {
      padding: 20px;
      text-align: center;
      font-style: italic;
      color: #6c757d;
      font-size: 1.1rem;
    }

    /* Error state */
    .search-error {
      padding: 20px;
      text-align: center;
      color: #dc3545;
      font-size: 1rem;
      background: rgba(220, 53, 69, 0.1);
      border-radius: 12px;
      border: 1px solid rgba(220, 53, 69, 0.2);
    }

    /* Responsive design */
    @media (max-width: 768px) {
      .bookshelf {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 25px 20px;
        padding: 30px 15px 40px;
      }

      .comic-card, .add-book-card {
        width: 150px;
        height: 230px;
      }

      .comic-card img {
        height: 190px;
      }

      h1 {
        font-size: 2rem;
      }
    }
  </style>
</head>
<body>
  <h1>DC Comics Bookshelf</h1>
  <div id="bookshelf" class="bookshelf"></div>

  <div id="addBookPanel" class="panel hidden">
    <button class="close-panel" onclick="closePanel()">&times;</button>
    <div class="search-bar-container">
      <input type="text" id="addBookSearch" placeholder="Search for DC superheroes...">
      <button id="addBookSearchBtn">Search</button>
    </div>
    <div id="searchResults"></div>
  </div>

  <script>
    const myBooks = [];
    const bookshelf = document.getElementById("bookshelf");
    let currentPage = 1;
    let currentQuery = "";

    function renderBooks() {
      bookshelf.innerHTML = "";

      const addCard = document.createElement("div");
      addCard.className = "add-book-card";
      addCard.innerHTML = "+";
      addCard.onclick = () => {
        document.getElementById("addBookPanel").classList.remove("hidden");
        document.getElementById("addBookSearch").focus();
      };
      bookshelf.appendChild(addCard);

      myBooks.forEach((book) => {
        const card = document.createElement("div");
        card.className = "comic-card";

        const img = document.createElement("img");
        img.src = book.image || "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgwIiBoZWlnaHQ9IjI0MCIgdmlld0JveD0iMCAwIDE4MCAyNDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxODAiIGhlaWdodD0iMjQwIiBmaWxsPSIjRTlFQ0VGIi8+Cjx0ZXh0IHg9IjkwIiB5PSIxMjAiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzZDNzU3RCIgdGV4dC1hbmNob3I9Im1pZGRsZSI+Tm8gSW1hZ2U8L3RleHQ+Cjwvc3ZnPg==";
        img.alt = book.title;
        img.onerror = function() {
          this.src = "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgwIiBoZWlnaHQ9IjI0MCIgdmlld0JveD0iMCAwIDE4MCAyNDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxODAiIGhlaWdodD0iMjQwIiBmaWxsPSIjRTlFQ0VGIi8+Cjx0ZXh0IHg9IjkwIiB5PSIxMjAiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzZDNzU3RCIgdGV4dC1hbmNob3I9Im1pZGRsZSI+Tm8gSW1hZ2U8L3RleHQ+Cjwvc3ZnPg==";
        };

        const title = document.createElement("h3");
        title.textContent = book.title;

        card.appendChild(img);
        card.appendChild(title);

        bookshelf.appendChild(card);
      });
    }

    async function searchMetron(query, page = 1) {
      const searchResults = document.getElementById("searchResults");
      if (page === 1) {
        searchResults.innerHTML = "<div class='search-loading'>Searching Metron Comic Database...</div>";
      }

      try {
        // Use CORS proxy to access Metron API
        const corsProxy = 'https://api.allorigins.win/raw?url=';
        const apiUrl = `https://metron.cloud/api/issue/?search=${encodeURIComponent(query)}&page=${page}`;
        const proxyUrl = corsProxy + encodeURIComponent(apiUrl);

        console.log(`Trying API via CORS proxy: ${apiUrl}`);
        
        const res = await fetch(proxyUrl, {
          method: 'GET',
          headers: {
            'Accept': 'application/json'
          }
        });
        
        if (!res.ok) {
          throw new Error(`HTTP ${res.status}: ${res.statusText}`);
        }
        
        const response = await res.json();
        console.log('API Response:', response);



        if (page === 1) searchResults.innerHTML = "";

        // Handle different possible response structures
        let results = [];
        if (response.results) {
          results = response.results;
        } else if (response.data) {
          results = response.data;
        } else if (Array.isArray(response)) {
          results = response;
        }

        if (results.length === 0 && page === 1) {
          searchResults.innerHTML = "<div class='search-loading'>No comics found. Try different search terms.</div>";
          return;
        }

        results.forEach(result => {
          const div = document.createElement("div");
          div.className = "search-result";

          const img = document.createElement("img");
          // Handle different possible image field names
          const imageUrl = result.image || result.cover_image || result.thumbnail || result.cover || '';
          img.src = imageUrl || "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iOTAiIHZpZXdCb3g9IjAgMCA2MCA5MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjYwIiBoZWlnaHQ9IjkwIiBmaWxsPSIjRTlFQ0VGIi8+Cjx0ZXh0IHg9IjMwIiB5PSI0NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEwIiBmaWxsPSIjNkM3NTdEIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5ObyBJbWFnZTwvdGV4dD4KPC9zdmc+";
          img.alt = result.title || result.name || "Comic";

          const infoDiv = document.createElement("div");
          infoDiv.className = "search-result-info";

          const titleSpan = document.createElement("div");
          titleSpan.className = "search-result-title";
          titleSpan.textContent = result.title || result.name || result.series_name || "Untitled Comic";

          const detailsSpan = document.createElement("div");
          detailsSpan.className = "search-result-details";
          
          // Build details string from available data
          const details = [];
          if (result.series) details.push(result.series);
          if (result.issue_number) details.push(`#${result.issue_number}`);
          if (result.cover_date) details.push(result.cover_date);
          if (result.year) details.push(result.year);
          
          detailsSpan.textContent = details.join(' â€¢ ') || 'DC Comics';

          infoDiv.appendChild(titleSpan);
          infoDiv.appendChild(detailsSpan);

          div.appendChild(img);
          div.appendChild(infoDiv);

          div.onclick = () => {
            const bookToAdd = {
              title: result.title || result.name || result.series_name || "Untitled Comic",
              image: imageUrl
            };
            myBooks.push(bookToAdd);
            renderBooks();
            closePanel();
          };

          searchResults.appendChild(div);
        });

        // Add "Load more" button if there might be more results
        if (results.length >= 10 || (response.next && response.next !== null)) {
          const showMore = document.createElement("div");
          showMore.className = "show-more";
          showMore.textContent = "Load more...";
          showMore.onclick = () => {
            currentPage++;
            searchSuperHeroes(currentQuery, currentPage);
          };
          searchResults.appendChild(showMore);
        }

      } catch (error) {
        console.error('Search error:', error);
        const errorMessage = error.message.includes('CORS') 
          ? "CORS Error: The Metron API doesn't allow direct browser requests. You'll need a backend server to proxy the requests."
          : `Search failed: ${error.message}`;
        
        searchResults.innerHTML = `<div class='search-error'>${errorMessage}<br><br>Try checking the browser console for more details.</div>`;
      }
    }

    function closePanel() {
      document.getElementById("addBookPanel").classList.add("hidden");
      document.getElementById("searchResults").innerHTML = "";
      document.getElementById("addBookSearch").value = "";
      currentPage = 1;
    }

    document.getElementById("addBookSearchBtn").addEventListener("click", () => {
      const query = document.getElementById("addBookSearch").value.trim();
      if (query.length > 0) {
        currentQuery = query;
        currentPage = 1;
        searchSuperHeroes(currentQuery, currentPage);
      }
    });

    document.getElementById("addBookSearch").addEventListener("keypress", (e) => {
      if (e.key === "Enter") {
        document.getElementById("addBookSearchBtn").click();
      }
    });

    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") closePanel();
    });

    renderBooks();
  </script>
</body>
</html>